# บอทที่ไม่ใช้เน็ตในการเล่นเพลง, การทำ Cache และรองรับจำนวนเซิร์ฟที่เพิ่มมากขึ้นในอนาคต

บอทหลายบาทมีเซิร์ฟใช้อยู่ถึง **140,000** เซิร์ฟ<br/>

## ซึ่งปัญหาที่ตามมาอันดับแรกเลยคือการที่แรมเต็ม
เพราะต้องเปิดถึง 150 Shards<br/>
เราเลยมาใช้ Discord.JS-Light<br/>
https://www.npmjs.com/package/discord.js-light<br/>
ปิดการเก็บ Cache ในแรม ที่ทางดิสส่งมาใน Events ต่าง ๆ ที่ไม่ได้จำเป็นในการใช้งานระบบบอท<br/>
เช่น อีโมจิ, ห้องแชท (เพราะใช้แค่ห้องเสียง และ Interaction ก็มีให้ทุกอย่างแล้ว)

## แบนวิชที่ทะลุ 600Mbps ในช่วงเวลาที่คนใช้เยอะ
เนื่องจากมีทั้ง การโหลดเพลงเข้า และการส่งเพลงออกให้กับดิส<br/>
เราสามารถแก้ปัญหาได้แบบง่ายสุดคือการใช้ Lavalink และเขียน Plugin<br/>
ให้ทำการเลือกคุณภาพเพลงที่ลดต่ำลงมา เนื่องจาก Lavalink จะเลือกคุณภาพสูงสุดเสมอ<br/>
นั่นคือ 192Kbps ซึ่งใช้ทรัพยากรเครื่องมาก และการปรับลงส่วนน้อยที่สังเกตเห็น<br/>
ห้องดิสที่ตั้งค่าเดิมอยู่ที่ 64Kbps อยู่แล้ว ถึงแม้ว่าอาจจะรับรู้ได้ว่าคุณภาพต่ำลงมาอย่างแน่นอน<br/>
แต่โดยส่วนใหญ่ ยังคงฟังเพลินเหมือนเดิม อารมณ์เดิม แทบไม่รู้สึกเลยว่ามีไรเปลี่ยน<br/>
รวมถึงหากเลือกให้ Lavalink ดึง Opus ตั้งแต่แรก Lavalink จะไม่ต้องทำการ Decode (ลด CPU)<br/>
ได้อย่างมาก ทำให้ Lavalink กลายเป็นเหมือนตัว Proxy ที่แค่รับเพลงจากยูทูบและส่งต่อให้ดิสทันที
**แก้ปัญหาการโหลดเพลงเข้า**<br/>
สามารถทำได้โดยการ **โหลดแล้วเก็บเป็น Cache ภายใน Disk** เวลามีคนเล่นเพลงเดิม ก็ให้มันโหลดจากใน Disk ไม่ต้องส่งขอกับทางยูทูบ **ทั้งลดเน็ตที่ใช้ โหลดเร็วกว่า และเลี่ยงการถูกแบนจากยูทูบ** ซึ่งเป็นระบบหลัก ๆ ที่หลายบาทนำมาประยุกต์ใช้ในระบบ<br/>
**เก็บข้อมูลทั้งหมดใน Cache แรม**<br/>
ไม่ว่าจะเป็นข้อมูลเพลง ชื่อ, ศิลปิน, Track หรืออื่น ๆ รวมถึงถ้าสามารถดักได้ใน Plugin Lavalink สามารถเก็บได้กระทั้ง Source Audio URL ที่ขอจากทางยูทูบ

## ผลการนำไอเดียข้างบนมาประยุกต์ใช้
บอทหลายบาทจากตอนแรกใช้ **600Mbps+ และ แรมถึง 60%+ CPU 40%+ ของเครื่อง**<br/>
ตอนนี้เหลือเพียง **350Mbps+ และ แรมไม่ถึง 55%+ CPU 30%+ ของเครื่อง**